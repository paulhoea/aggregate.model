<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aggregate.model">
<title>Example Workflow • aggregate.model</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Workflow">
<meta property="og:description" content="aggregate.model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aggregate.model</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-workflow.html">Example Workflow</a>
    <a class="dropdown-item" href="../articles/new_variable_to_dict.html">Adding a new variable to the Dictionary</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Workflow</h1>
            
      
      
      <div class="d-none name"><code>example-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://moritzschwarz.org/getspanel/" class="external-link">aggregate.model</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="setting-up-the-model">Setting up the Model<a class="anchor" aria-label="anchor" href="#setting-up-the-model"></a>
</h2>
<div class="section level3">
<h3 id="dictionary">Dictionary<a class="anchor" aria-label="anchor" href="#dictionary"></a>
</h3>
<p>In this illustration, we will rely on the default dictionary that is
available from <code>dict</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model_varname</span>, <span class="va">database</span>, <span class="va">dataset_id</span>, <span class="va">variable_code</span>, <span class="va">freq</span>, <span class="va">geo</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   model_varname database  dataset_id variable_code freq  geo</span></span>
<span><span class="co">#&gt; 1          TOTS     &lt;NA&gt;        &lt;NA&gt;          TOTS &lt;NA&gt; &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2           GDP eurostat namq_10_gdp          B1GQ    q   AT</span></span>
<span><span class="co">#&gt; 3     GValueAdd eurostat namq_10_a10           B1G    q   AT</span></span>
<span><span class="co">#&gt; 4        Export eurostat namq_10_gdp            P6    q   AT</span></span>
<span><span class="co">#&gt; 5        Import eurostat namq_10_gdp            P7    q   AT</span></span>
<span><span class="co">#&gt; 6  GCapitalForm eurostat namq_10_gdp           P5G    q   AT</span></span>
<span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model_varname</span>, <span class="va">database</span>, <span class="va">dataset_id</span>, <span class="va">variable_code</span>, <span class="va">freq</span>, <span class="va">geo</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       model_varname database</span></span>
<span><span class="co">#&gt; 35              HDD eurostat</span></span>
<span><span class="co">#&gt; 36              CDD eurostat</span></span>
<span><span class="co">#&gt; 37  EmiCH4Livestock    edgar</span></span>
<span><span class="co">#&gt; 38   EmiCO2Industry    edgar</span></span>
<span><span class="co">#&gt; 39 EmiCO2Combustion    edgar</span></span>
<span><span class="co">#&gt; 40      EmiN2OTotal    edgar</span></span>
<span><span class="co">#&gt;                                                                                                       dataset_id</span></span>
<span><span class="co">#&gt; 35                                                                                                    nrg_chdd_m</span></span>
<span><span class="co">#&gt; 36                                                                                                    nrg_chdd_m</span></span>
<span><span class="co">#&gt; 37 https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/EDGAR/datasets/v70_FT2021_GHG/v70_FT2021_CH4_m_2000_2021.zip</span></span>
<span><span class="co">#&gt; 38 https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/EDGAR/datasets/v70_FT2021_GHG/v70_FT2021_CO2_m_2000_2021.zip</span></span>
<span><span class="co">#&gt; 39 https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/EDGAR/datasets/v70_FT2021_GHG/v70_FT2021_CO2_m_2000_2021.zip</span></span>
<span><span class="co">#&gt; 40 https://jeodpp.jrc.ec.europa.eu/ftp/jrc-opendata/EDGAR/datasets/v70_FT2021_GHG/v70_FT2021_N2O_m_2000_2021.zip</span></span>
<span><span class="co">#&gt;    variable_code freq geo</span></span>
<span><span class="co">#&gt; 35           HDD    m  AT</span></span>
<span><span class="co">#&gt; 36           CDD    m  AT</span></span>
<span><span class="co">#&gt; 37          &lt;NA&gt;    m  AT</span></span>
<span><span class="co">#&gt; 38          &lt;NA&gt;    m  AT</span></span>
<span><span class="co">#&gt; 39          &lt;NA&gt;    m  AT</span></span>
<span><span class="co">#&gt; 40          &lt;NA&gt;    m  AT</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specification">Specification<a class="anchor" aria-label="anchor" href="#specification"></a>
</h3>
<p>We use a specification for illustrative purposes only. Our
specification contains the following four modules/equations:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specification</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"d"</span>,</span>
<span>      <span class="st">"d"</span>,</span>
<span>      <span class="st">"n"</span>,</span>
<span>      <span class="st">"n"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    dependent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"StatDiscrep"</span>,</span>
<span>      <span class="st">"TOTS"</span>,</span>
<span>      <span class="st">"Import"</span>,</span>
<span>      <span class="st">"EmiCO2Combustion"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    independent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"TOTS - FinConsExpHH - FinConsExpGov - GCapitalForm - Export"</span>,</span>
<span>      <span class="st">"GValueAdd + Import"</span>,</span>
<span>      <span class="st">"FinConsExpHH + GCapitalForm"</span>,</span>
<span>      <span class="st">"HDD + HICP_Energy + GValueAdd"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">specification</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   type  dependent        independent                                            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> d     StatDiscrep      TOTS - FinConsExpHH - FinConsExpGov - GCapitalForm - E…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> d     TOTS             GValueAdd + Import                                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> n     Import           FinConsExpHH + GCapitalForm                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> n     EmiCO2Combustion HDD + HICP_Energy + GValueAdd</span></span></code></pre></div>
<p>The first two equations are simply accounting identities. The third
equation models imports as a function of final consumption expenditure
of households and gross capital formation. The fourth equation models
carbon emissions from combustion activities, which includes energy
industries, manufacturing and construction, transport, and combustion
activities in other sectors.The regressors are the number of heating
degree days, the harmonised index of consumer prices for energy, and
total gross value added.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>We differentiate between where data can be obtained from <em>in
principle</em> versus where it should be obtained from <em>actually</em>
in a specific model run. For example, a variable that is available on
Eurostat can be downloaded from Eurostat but might have been saved
locally from a previous model run. In order to save time, the user might
prefer that the local data is used rather than re-downloading the
data.</p>
<p>The dictionary specifies where the data for the different variables
can be obtained <em>in principle</em>. The column
<code>dict$database</code> may take one of four different values:</p>
<ul>
<li>
<code>eurostat</code> if the variable is available from Eurostat
using <code><a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html" class="external-link">eurostat::get_eurostat()</a></code>,</li>
<li>
<code>edgar</code> if the (emissions) variable is available EDGAR
using a link,</li>
<li>
<code>local</code> if the variable is not available from the above
two sources and is therefore provided as a local file by the user in the
directory <code>inputdata_directory</code>. This directory is searched
for <code>.rds</code>, <code>.csv</code>, and <code>.xlsx</code> files,
opens them consecutively, and searches for the variable.</li>
<li>
<code>NA</code> if the variable is constructed as an
identity/definition</li>
</ul>
<p>The argument <code>primary_source</code> in the main function
<code><a href="../reference/run_model.html">run_model()</a></code> governs how the data is <em>actually</em>
obtained in this model run. Data that can in principle be downloaded
from <code>eurostat</code> or <code>edgar</code> can also be loaded
locally if it has been saved manually by the user or using the
<code>save_to_disk</code> argument in <code><a href="../reference/run_model.html">run_model()</a></code> in a
previous model run. The argument <code>primary_source</code> can take
either the value <code>"download"</code> or <code>"local"</code>, which
governs whether download or local input takes precedence for
<code>eurostat</code> and <code>edgar</code> variables.</p>
<p>This gives rise to the following combinations of obtaining data:</p>
<ul>
<li>variables with <code>dictionary$database == "local"</code> are
always searched for among the local files of
<code>inputdata_directory</code> and an error is raised if they cannot
be found there</li>
<li>variables with <code>dictionary$database == "eurostat"</code> or
<code>dictionary$database == "egdar"</code>
<ul>
<li>argument <code>primary_source == "download"</code> first downloads
all the variables (potentially updating the values) and only searches
the local directory if the variables cannot be obtained that way
(e.g. if there were problems with the download)</li>
<li>argument <code>primary_source == "local"</code> first searches the
local directory and only downloads those variables that could not be
found locally</li>
</ul>
</li>
</ul>
<p>Here, we use variables that can <em>in principle</em> all be obtained
from either Eurostat or EDGAR but we use the local file
<code>example-workflow-data.rds</code> to save time when compiling the
vignette.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StatDiscrep"</span>, <span class="st">"TOTS"</span>, <span class="st">"Import"</span>, <span class="st">"EmiCO2Combustion"</span>, <span class="st">"FinConsExpHH"</span>,</span>
<span>          <span class="st">"FinConsExpGov"</span>, <span class="st">"GCapitalForm"</span>, <span class="st">"Export"</span>, <span class="st">"GValueAdd"</span>, <span class="st">"HDD"</span>,</span>
<span>          <span class="st">"HICP_Energy"</span><span class="op">)</span></span>
<span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">model_varname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">vars</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">database</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] NA         "eurostat" "eurostat" "eurostat" "eurostat" "eurostat"</span></span>
<span><span class="co">#&gt;  [7] "eurostat" "eurostat" "eurostat" "eurostat" "edgar"</span></span></code></pre></div>
<p>To avoid downloading all those variables again, we will specify
<code>primary_source == "local"</code> and provide a
<code>inputdata_directory</code> path to the local directory when
calling <code><a href="../reference/run_model.html">run_model()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-model">Running the Model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>We are now ready to run the model and obtain an <code>"aggmod"</code>
object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>specification <span class="op">=</span> <span class="va">specification</span>,</span>
<span>                   dictionary <span class="op">=</span> <span class="va">dict</span>,</span>
<span>                   inputdata_directory <span class="op">=</span> <span class="st">"."</span>,</span>
<span>                   primary_source <span class="op">=</span> <span class="st">"local"</span>,</span>
<span>                   save_to_disk <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   present <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Local files are used.</span></span>
<span><span class="co">#&gt; The following files are opened and scanned for relevant data for the model.</span></span>
<span><span class="co">#&gt; example-workflow-data.rds</span></span>
<span><span class="co">#&gt; Note: If these include non-data files (with a likely different structure and hence likely errors), it is recommended to move all data files to a dedicated directory or to save them there using the 'save_to_disk' argument in the first place:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You can quiet this message with quiet = TRUE.</span></span>
<span><span class="co">#&gt; Warning in load_or_download_variables(specification = module_order, dictionary</span></span>
<span><span class="co">#&gt; = dictionary, : Unbalanced panel, will lose more than 20\% of data when making</span></span>
<span><span class="co">#&gt; balanced</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Estimation begins ---</span></span>
<span><span class="co">#&gt; Estimating Import = FinConsExpHH + GCapitalForm </span></span>
<span><span class="co">#&gt; Estimating EmiCO2Combustion = HDD + HICP_Energy + GValueAdd </span></span>
<span><span class="co">#&gt; Constructing TOTS = GValueAdd + Import </span></span>
<span><span class="co">#&gt; Constructing StatDiscrep = TOTS - FinConsExpHH - FinConsExpGov - GCapitalForm - Export</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "aggmod"</span></span></code></pre></div>
<p>We did not <code>quiet</code> the output, so we get some information
about the estimation.</p>
<p>We are told that local files are used, namely the file
<code>"example-workflow-data.rds"</code>, which can be found in our
working directory <code>"."</code> from where the vignette is created.
Next, we obtain a warning that the panel is unbalanced, which means that
we have “ragged edges” that cause more than 20% of the data to be
discarded when limiting the sample to the time periods that are
available for <strong>all</strong> variables.</p>
<p>Finally, the estimation begins. The order of the modules is
determined by how they are related to each other, starting with the
modules that only depend on exogenous (unmodelled) variables and then
gradually estimating the other modules in order to avoid any reverse
dependencies.</p>
</div>
<div class="section level2">
<h2 id="evaluating-the-model">Evaluating the Model<a class="anchor" aria-label="anchor" href="#evaluating-the-model"></a>
</h2>
<p>Now, we can have a look at the model results.</p>
<div class="section level3">
<h3 id="individual-module-results">Individual Module Results<a class="anchor" aria-label="anchor" href="#individual-module-results"></a>
</h3>
<p>The different modules are stored in
<code>model$module_collection</code>, which is a tibble that stores the
datasets, independent and dependent variables, model arguments, and the
model itself as an <code>"isat"</code> object.</p>
<p>For example, taking a closer look at the estimated module for carbon
emissions from combustion activities:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the isat model object</span></span>
<span><span class="va">co2module</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">module_collection</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dependent</span> <span class="op">==</span> <span class="st">"EmiCO2Combustion"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">co2module</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "isat"</span></span>
<span><span class="co"># inspect the estimated equation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">co2module</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date: Mon Jan 22 10:07:12 2024 </span></span>
<span><span class="co">#&gt; Dependent var.: y </span></span>
<span><span class="co">#&gt; Method: Ordinary Least Squares (OLS)</span></span>
<span><span class="co">#&gt; Variance-Covariance: Ordinary </span></span>
<span><span class="co">#&gt; No. of observations (mean eq.): 88 </span></span>
<span><span class="co">#&gt; Sample: 1 to 88 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SPECIFIC mean equation:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                     coef   std.error  t-stat   p-value    </span></span>
<span><span class="co">#&gt; mconst        1.65723367  1.57041425  1.0553 0.2945119    </span></span>
<span><span class="co">#&gt; trend        -0.00279700  0.00045517 -6.1449 3.051e-08 ***</span></span>
<span><span class="co">#&gt; ln.HDD        0.09832576  0.02549129  3.8572 0.0002327 ***</span></span>
<span><span class="co">#&gt; ln.GValueAdd  0.70874663  0.14185904  4.9961 3.434e-06 ***</span></span>
<span><span class="co">#&gt; q_2          -0.24228972  0.03085694 -7.8520 1.692e-11 ***</span></span>
<span><span class="co">#&gt; q_3          -0.27299057  0.05324977 -5.1266 2.049e-06 ***</span></span>
<span><span class="co">#&gt; q_4          -0.05980636  0.01166827 -5.1256 2.057e-06 ***</span></span>
<span><span class="co">#&gt; sis8          0.07357979  0.02039646  3.6075 0.0005401 ***</span></span>
<span><span class="co">#&gt; sis13         0.07758571  0.01864915  4.1603 8.022e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Diagnostics and fit:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                   Chi-sq df p-value  </span></span>
<span><span class="co">#&gt; Ljung-Box AR(1)   3.1001  1 0.07829 .</span></span>
<span><span class="co">#&gt; Ljung-Box ARCH(1) 1.8645  1 0.17210  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt;                           </span></span>
<span><span class="co">#&gt; SE of regression   0.03458</span></span>
<span><span class="co">#&gt; R-squared          0.97412</span></span>
<span><span class="co">#&gt; Log-lik.(n=88)   175.70269</span></span></code></pre></div>
<p>We find that the number of heating degree days (<code>HDD</code>) and
gross value added (<code>GValueAdd</code>) are significant, while gets
model selection dropped the harmonised consumer price index for energy.
Both gross value added and heating degree days have a positive
coefficient meaning that they increase emissions, as we would
expect.</p>
<p>Both diagnostic tests of no autocorrelation and no autoregressive
conditional heteroskedasticity pass.</p>
</div>
<div class="section level3">
<h3 id="module-network">Module Network<a class="anchor" aria-label="anchor" href="#module-network"></a>
</h3>
<p>We can show the relationship between the different modules using the
<code><a href="../reference/network.html">network()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/network.html">network</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-workflow_files/figure-html/network-1.png" width="672">
Each node represents a module and the different colours represent
whether the variable is given by a definition/identity, whether it has
been modelled as an endogenous variable depending on other models, and
whether it is an exogenous variable input to the models.</p>
<p>An solid line arrow means that the variable has been retained during
model selection, while a dashed arrow means that the variable has been
dropped during model selection. Note again that <code>HICP_Energy</code>
was in the original specification but has been found to be
insignificant.</p>
</div>
<div class="section level3">
<h3 id="forecasts">Forecasts<a class="anchor" aria-label="anchor" href="#forecasts"></a>
</h3>
<p>We can use our model to forecast the variables of our modules. This
works for both the definition/identity modules and the endogenous
modules. The user can either provide future values for the exogenous
variables (e.g. corresponding to certain scenario assumptions) or use
automatic AR models to forecast future values of the exogenous
variables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_model.html">forecast_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>,</span>
<span>                           exog_predictions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           plot.forecast <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; No exogenous values provided. Model will forecast the exogenous values with an AR4 process (incl. Q dummies, IIS and SIS w 't.pval = 0.001').</span></span>
<span><span class="co">#&gt; Alternative is exog_fill_method = 'last'.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">forecast</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "aggmod.forecast"</span></span></code></pre></div>
<p>We did not specify paths for the exogenous regressors, so the output
informs us that AR(4) processes were used to project their paths. The
function returns an object of class <code>"aggmod.forecast"</code>,
which can also be plotted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forecast</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-workflow_files/figure-html/forecast-plot-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>To obtain an overview of the diagnostic results for each endogenous
module, we can use the command <code><a href="../reference/diagnostics_model.html">diagnostics_model()</a></code>. This
avoids having to look at all <code>"isat"</code> model objects
manually.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostics_model.html">diagnostics_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;             module         AR      ARCH IIS SIS  n indicator_share</span></span>
<span><span class="co">#&gt; 1           Import 0.34427814 0.3038267   5   0 87      0.05747126</span></span>
<span><span class="co">#&gt; 2 EmiCO2Combustion 0.07828958 0.1721016   0   2 88      0.02272727</span></span></code></pre></div>
<p>The diagnostics pass for both modules: we neither have evidence for
autocorrelated errors nor for autoregressive conditional
heteroskedasticity.</p>
<p>The output also shows how many impulse indicators (representing
outliers) and step indicators (representing structural breaks of the
mean) have been retained in each module, both in absolute and as a share
of the observations.</p>
</div>
<div class="section level3">
<h3 id="shiny-app">Shiny App<a class="anchor" aria-label="anchor" href="#shiny-app"></a>
</h3>
<p>Last but not least, we can get an overview and summary of the whole
aggregate model results in a Shiny app, which can be opened using the
<code><a href="../reference/present_model.html">present_model()</a></code> command. The following code snippet is not
executed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/present_model.html">present_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonas Kurle, Moritz Schwarz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
