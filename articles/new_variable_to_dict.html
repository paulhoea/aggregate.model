<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aggregate.model">
<title>Adding a new variable to the Dictionary • aggregate.model</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding a new variable to the Dictionary">
<meta property="og:description" content="aggregate.model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aggregate.model</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-workflow.html">Example Workflow</a>
    <a class="dropdown-item" href="../articles/new_variable_to_dict.html">Adding a new variable to the Dictionary</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Adding a new variable to the Dictionary</h1>
            
      
      
      <div class="d-none name"><code>new_variable_to_dict.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://moritzschwarz.org/getspanel/" class="external-link">aggregate.model</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropengov.github.io/eurostat/" class="external-link">eurostat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>This is a vignette to describe the process to add a new variable to
the Dictionary of the package. This is necessary if we want to use a new
variable in the Aggregate Model. Here we initially discuss three cases:
1) the case of adding a <strong>Eurostat</strong> variable and 2) adding
a new variable from the <strong>EDGAR</strong> emission dataset and
lastly 3) to simply create a new identity based on existing
variables.</p>
<div class="section level2">
<h2 id="tldr">tl,dr<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<p>This is an example how you add a new variable to the Dictionary:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a new row to 'dict', which is an element of the aggregate.model package</span></span>
<span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    model_varname <span class="op">=</span> <span class="st">"IndProd"</span>, <span class="co"># this is free to choose but must be unique</span></span>
<span>    full_name <span class="op">=</span> <span class="st">"An index of Industrial Production"</span>,</span>
<span>    database  <span class="op">=</span> <span class="st">"eurostat"</span>,</span>
<span>    variable_code <span class="op">=</span> <span class="st">"PROD"</span>, <span class="co"># in this case use the bt_indicator information here</span></span>
<span>    dataset_id <span class="op">=</span> <span class="st">"sts_inpr_q"</span>,</span>
<span>    var_col <span class="op">=</span> <span class="st">"indic_bt"</span>, <span class="co"># here we specify what the column with the variables is called</span></span>
<span>    freq <span class="op">=</span> <span class="st">"q"</span>, <span class="co"># for quarterly data, 'm' would be monthly</span></span>
<span>    geo <span class="op">=</span> <span class="st">"AT"</span>,</span>
<span>    unit <span class="op">=</span> <span class="st">"I15"</span>, <span class="co"># for index of 2015 = 100</span></span>
<span>    s_adj <span class="op">=</span> <span class="st">"NSA"</span>, <span class="co"># not seasonally adjusted</span></span>
<span>    nace_r2 <span class="op">=</span> <span class="st">"B-D"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">new_dict</span></span>
<span></span>
<span><span class="co"># now use the new_dict in run_model</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="some-general-remarks-about-the-dictionary">Some general remarks about the Dictionary<a class="anchor" aria-label="anchor" href="#some-general-remarks-about-the-dictionary"></a>
</h2>
<p>The dictionary is the central store of information that is being used
for us to “translate” difficult data codes into useful variable names -
and it is also central for us to tell the Aggregate Model what to
download.</p>
<p>Let’s take a look at the dictionary:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">as_tibble</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 14</span></span></span>
<span><span class="co">#&gt;    model_varname full_name database variable_code dataset_id var_col freq  geo  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> TOTS          Total Su… <span style="color: #BB0000;">NA</span>       TOTS          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> GDP           Gross do… eurostat B1GQ          namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> GValueAdd     Value ad… eurostat B1G           namq_10_a… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Export        Exports … eurostat P6            namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Import        Imports … eurostat P7            namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> GCapitalForm  Gross ca… eurostat P5G           namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> FinConsExp    Final co… eurostat P3            namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> FinConsExpGov Final co… eurostat P3_S13        namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> FinConsExpHH  Househol… eurostat P31_S14_S15   namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> StatDiscrep   Statisti… eurostat YA0           namq_10_g… na_item q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: unit &lt;chr&gt;, s_adj &lt;chr&gt;, nace_r2 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ipcc_sector &lt;chr&gt;, cpa2_1 &lt;chr&gt;, siec &lt;lgl&gt;</span></span></span></code></pre></div>
<p>A few words about the variables/columns in the dictionary: There are
a few crucial columns that will nearly always be needed/useful. These
are:</p>
<ul>
<li><p><strong>model_varname:</strong> Variable name in the model
equations, must be unique.</p></li>
<li><p><strong>full_name:</strong> Full name/description of the
variable.</p></li>
</ul>
<p>Currently full in use are also the columns:</p>
<ul>
<li><p><strong>database:</strong> Name of the database. Internally
implemented are “eurostat” and “edgar.”</p></li>
<li><p><strong>variable_code:</strong> Identifier of the variable if
applicable, e.g., Eurostat variable code.</p></li>
<li><p><strong>dataset_id:</strong> Identifier of the dataset where the
variable is available, e.g., Eurostat dataset code or link to file on
the web.</p></li>
</ul>
<p>More varied is the use of:</p>
<ul>
<li><p><strong>var_col:</strong> Name of variable/column in the
dataset.</p></li>
<li><p><strong>freq:</strong> Frequency of the variable in the dataset.
“m” for monthly, “q” for quarterly.</p></li>
<li><p><strong>geo:</strong> ISO 3166-1 alpha-2 country code.</p></li>
<li><p><strong>unit:</strong> Eurostat unit in which the variable is
measured, e.g., to choose between different measurements for the same
variable.</p></li>
<li><p><strong>s_adj:</strong> Eurostat seasonal adjustment or
not.</p></li>
<li><p><strong>nace_r2:</strong> Eurostat identifier for NACE Rev. 2
classification.</p></li>
<li><p><strong>ipcc_sector:</strong> EDGAR IPCC National Greenhouse Gas
Inventories, see <a href="https://www.ipcc-nggip.iges.or.jp/public/2006gl/index.html" class="external-link">link</a>.
“TOTAL” is not an official IPCC code but is internally interpreted to
use country totals.</p></li>
<li><p><strong>cpa2_1:</strong> Eurostat identifier for Classification
of Products by Activity (CPA).</p></li>
<li><p><strong>siec:</strong> Standard International Energy Product
Classification, e.g., for Eurostat.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="adding-a-variable-from-eurostat">Adding a variable from Eurostat<a class="anchor" aria-label="anchor" href="#adding-a-variable-from-eurostat"></a>
</h2>
<p>Firstly, head over to Eurostat to find out more about the variable
you would like to add. There are a few data viewer options in Eurostat,
but we recommend using the “Data Explorer” for this. Here is a good link
to get started:</p>
<p><a href="https://ec.europa.eu/eurostat/databrowser/explore/all/all_themes" class="external-link">Eurostat
Data Viewer Data Navigation Tree</a></p>
<p><img src="eurostat_datatree.png" style="width:100.0%"></p>
<div class="section level3">
<h3 id="identifying-the-correct-information-needed">Identifying the correct information needed<a class="anchor" aria-label="anchor" href="#identifying-the-correct-information-needed"></a>
</h3>
<p>Now let’s assume that we want to add some form of <strong>Industrial
Production</strong> to the dataset <a href="https://ec.europa.eu/eurostat/databrowser/view/sts_inpr_q/default/table?lang=en" class="external-link">(Link</a>).
So we head back to the data tree and select the quarterly dataset for
Industrial Production (<code>sts_inpr_q</code>):</p>
<p><img src="eurostat_datatree_industry.png" style="width:100.0%"></p>
<p>Now let’s take a closer look at the data features that are typically
at the top of the screen:</p>
<p><img src="eurostat_indprod_overview.png" style="width:100.0%"></p>
<p>This already gives us something crucial: the dataset identifier, in
this case <code>sts_inpr_q</code>. This corresponds to the column
<code>dataset_id</code> in the Dictionary <code>dict</code>.</p>
<p>To find out even more about all the detailed features of the dataset,
we click on the big encircled <code>+</code> that are e.g. next to
“Time” or “Unit of Measure”. This gives us the ability to play around a
bit more and define a custom dataset for our specific needs:</p>
<p><img src="eurostat_indprod_custom.png" style="width:100.0%"></p>
<p>This really is the window that we will need to focus on quite a bit.
First of all, we note that the different dimensions of the data are
encapsulated in square brackets <code>[ ]</code>, like
<code>time</code>, <code>indicator_bt</code>, or <code>s_adj</code>,
here the most relevant marked in yellow:</p>
<p><img src="eurostat_indprod_custom_col.png" style="width:100.0%"></p>
<p>To identify the correct data, we now need to click through the
different dimensions and make note of what it is that we want to
use.</p>
<p>While the available types will vary depending on Eurostat data, most
variables relevant for the Aggregate Model will include:</p>
<ul>
<li><p>Some variable that indicates the specific variable name, like
<code>na_item</code> or <code>indic_bt</code>, depending on the Eurostat
guidelines associated with the data collection method used.</p></li>
<li><p><code>time</code></p></li>
<li><p><code>geo</code>: the geography that the data belongs to (see <a href="https://ec.europa.eu/eurostat/statistics-explained/index.php?title=Glossary:Country_codes" class="external-link">Glossary:Country
codes - Statistics Explained (europa.eu)</a> for more information on the
format).</p></li>
<li><p><code>unit</code>: the unit of the variable like €, tonnes, %,
etc. (frequently also some kind of indices like <code>I15</code> for
<code>Index = 2015</code>). This corresponds to the unit column in the
Dictionary dict.</p></li>
<li><p><code>s_adj</code>: Seasonal Adjustment, e.g. NSA refers to “No
Seasonal Adjustment”</p></li>
<li>
<p>Sometimes the data we consider can be broken down even further,
e.g. according to sectors or physical quantities (like different
greenhouse gases). These include for example things like:</p>
<ul>
<li><p><code>nace_r2</code>: A column and indicator that indicates the
sector according to the Statistical classification of economic
activities in the European Community (NACE Revision 2)</p></li>
<li><p><code>cp2_1</code>: A column and indicator that indicates the <a href="https://op.europa.eu/en/web/eu-vocabularies/dataset/-/resource?uri=http://publications.europa.eu/resource/dataset/cpa21" class="external-link">Statistical
classification of products by activity, 2.1 (CPA 2.1)</a></p></li>
<li><p><code>siec</code>: Standard International Energy Product
Classification</p></li>
</ul>
</li>
</ul>
<p>Based on all the information above, let’s say that we want to add a
variable from the dataset <code>sts_inpr_q</code>:</p>
<ul>
<li><p>industrial production,</p></li>
<li><p>that spans all NACE rev. 2 sectors in the sectors B to
D,</p></li>
<li><p>for Austria,</p></li>
<li><p>using the unit of an index that is set to the 2015 value
and</p></li>
<li><p>is not seasonally adjusted.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="checking-the-new-variable">Checking the new variable<a class="anchor" aria-label="anchor" href="#checking-the-new-variable"></a>
</h3>
<p>Given this information, let’s try to download it first - using the
<code>get_eurostat</code> function from the {<code>eurostat}</code>
package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html" class="external-link">get_eurostat</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"sts_inpr_q"</span><span class="op">)</span></span>
<span><span class="va">dat_raw</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,393,014 × 8</span></span></span>
<span><span class="co">#&gt;    freq  indic_bt nace_r2 s_adj unit  geo   TIME_PERIOD values</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Q     PROD     B       CA    I10   AT    1996-01-01    64.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Q     PROD     B       CA    I10   AT    1996-04-01    85.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Q     PROD     B       CA    I10   AT    1996-07-01    90.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Q     PROD     B       CA    I10   AT    1996-10-01    87.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Q     PROD     B       CA    I10   AT    1997-01-01    66.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Q     PROD     B       CA    I10   AT    1997-04-01    82.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Q     PROD     B       CA    I10   AT    1997-07-01    85.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Q     PROD     B       CA    I10   AT    1997-10-01    82.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Q     PROD     B       CA    I10   AT    1998-01-01    69.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Q     PROD     B       CA    I10   AT    1998-04-01    91.1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,393,004 more rows</span></span></span></code></pre></div>
<p>Now let’s filter this raw dataset down to the data series that we
need:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">indic_bt</span> <span class="op">==</span> <span class="st">"PROD"</span>, <span class="co"># for industrial production variable</span></span>
<span>         <span class="va">nace_r2</span> <span class="op">==</span> <span class="st">"B-D"</span>, <span class="co"># to select all NACE rev 2 sectors in B, C, and D</span></span>
<span>         <span class="va">s_adj</span> <span class="op">==</span> <span class="st">"NSA"</span>, <span class="co"># to get the raw, non-adjusted data</span></span>
<span>         <span class="va">unit</span> <span class="op">==</span> <span class="st">"I15"</span>, <span class="co"># to get the 2015 Index</span></span>
<span>         <span class="va">geo</span> <span class="op">==</span> <span class="st">"AT"</span> <span class="co"># to get only the Austrian data</span></span>
<span>         <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">dat_AT</span></span>
<span><span class="va">dat_AT</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 112 × 8</span></span></span>
<span><span class="co">#&gt;    freq  indic_bt nace_r2 s_adj unit  geo   TIME_PERIOD values</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Q     PROD     B-D     NSA   I15   AT    1996-01-01    50.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Q     PROD     B-D     NSA   I15   AT    1996-04-01    51.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Q     PROD     B-D     NSA   I15   AT    1996-07-01    51.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Q     PROD     B-D     NSA   I15   AT    1996-10-01    56  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Q     PROD     B-D     NSA   I15   AT    1997-01-01    51.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Q     PROD     B-D     NSA   I15   AT    1997-04-01    55.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Q     PROD     B-D     NSA   I15   AT    1997-07-01    55.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Q     PROD     B-D     NSA   I15   AT    1997-10-01    60.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Q     PROD     B-D     NSA   I15   AT    1998-01-01    57.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Q     PROD     B-D     NSA   I15   AT    1998-04-01    60.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 102 more rows</span></span></span></code></pre></div>
<p>This looks quite good. We can plot this really quickly:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat_AT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">TIME_PERIOD</span>, y <span class="op">=</span> <span class="va">values</span>, color <span class="op">=</span> <span class="va">indic_bt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co"># add some styling</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># to get a line through 0</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Industrial Production in Austria"</span>, x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Industrial Production Index, 2015 = 100"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="new_variable_to_dict_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="adding-the-variable-to-the-dictionary">Adding the variable to the dictionary<a class="anchor" aria-label="anchor" href="#adding-the-variable-to-the-dictionary"></a>
</h3>
<p>Now that we know what the data looks like and have verified that this
is what we want to add, we can add this to the dictionary. For this, we
consider the column names of the dictionary again.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">names</span></span>
<span><span class="co">#&gt;  [1] "model_varname" "full_name"     "database"      "variable_code"</span></span>
<span><span class="co">#&gt;  [5] "dataset_id"    "var_col"       "freq"          "geo"          </span></span>
<span><span class="co">#&gt;  [9] "unit"          "s_adj"         "nace_r2"       "ipcc_sector"  </span></span>
<span><span class="co">#&gt; [13] "cpa2_1"        "siec"</span></span></code></pre></div>
<p>And of course checking the documentation of dict again:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">dict</span></span></code></pre></div>
<p>Essentially, we need to add our new variable to our dictionary by
simply adding it as a new row. We can e.g. do this with
<code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows()</a></code>. Depending on the
variable that we consider, we will need to fill out as many columns as
possible. For our example this means:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    model_varname <span class="op">=</span> <span class="st">"IndProd"</span>, <span class="co"># this is free to choose but must be unique</span></span>
<span>    full_name <span class="op">=</span> <span class="st">"An index of Industrial Production"</span>,</span>
<span>    database  <span class="op">=</span> <span class="st">"eurostat"</span>,</span>
<span>    variable_code <span class="op">=</span> <span class="st">"PROD"</span>, <span class="co"># in this case use the bt_indicator information here</span></span>
<span>    dataset_id <span class="op">=</span> <span class="st">"sts_inpr_q"</span>,</span>
<span>    var_col <span class="op">=</span> <span class="st">"indic_bt"</span>, <span class="co"># here we specify what the column with the variables is called</span></span>
<span>    freq <span class="op">=</span> <span class="st">"q"</span>, <span class="co"># for quarterly data, 'm' would be monthly</span></span>
<span>    geo <span class="op">=</span> <span class="st">"AT"</span>,</span>
<span>    unit <span class="op">=</span> <span class="st">"I15"</span>, <span class="co"># for index of 2015 = 100</span></span>
<span>    s_adj <span class="op">=</span> <span class="st">"NSA"</span>, <span class="co"># not seasonally adjusted</span></span>
<span>    nace_r2 <span class="op">=</span> <span class="st">"B-D"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">new_dict</span></span></code></pre></div>
<p>Now we are done and have successfully created a new dictionary!!</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">tail</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;   model_varname  full_name database variable_code dataset_id var_col freq  geo  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> CDD            Cooling … eurostat CDD           nrg_chdd_m indic_… m     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> EmiCH4Livesto… Methane … edgar    <span style="color: #BB0000;">NA</span>            https://j… <span style="color: #BB0000;">NA</span>      m     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> EmiCO2Industry Carbon E… edgar    <span style="color: #BB0000;">NA</span>            https://j… <span style="color: #BB0000;">NA</span>      m     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> EmiCO2Combust… Carbon E… edgar    <span style="color: #BB0000;">NA</span>            https://j… <span style="color: #BB0000;">NA</span>      m     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> EmiN2OTotal    Nitrous … edgar    <span style="color: #BB0000;">NA</span>            https://j… <span style="color: #BB0000;">NA</span>      m     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> IndProd        An index… eurostat PROD          sts_inpr_q indic_… q     AT   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: unit &lt;chr&gt;, s_adj &lt;chr&gt;, nace_r2 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ipcc_sector &lt;chr&gt;, cpa2_1 &lt;chr&gt;, siec &lt;lgl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quickly-run-a-small-model-to-check-if-it-works">Quickly run a small model to check if it works:<a class="anchor" aria-label="anchor" href="#quickly-run-a-small-model-to-check-if-it-works"></a>
</h3>
<p>We can now put this to the test in an extremely small model. We
construct a model of the CO[2] Emissions in Industry as a function of
Gas and Electricity Prices as well as our new measure for Industrial
Production:</p>
<p><span class="math display">\[
EmiCO2Industry = HICP_{Gas} + HICP_{Electricity} + IndProd
\]</span></p>
<p>We put this into our specification table alongside a simple identity
that we need for the moment because the current set-up does not allow
not adding any identities.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specification</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"n"</span>,</span>
<span>    <span class="st">"d"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dependent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"EmiCO2Industry"</span>,</span>
<span>    <span class="st">"TOTS"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  independent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"HICP_Gas + HICP_Electricity + IndProd"</span>,</span>
<span>    <span class="st">"GDP + Import"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">specification</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   type  dependent      independent                          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> n     EmiCO2Industry HICP_Gas + HICP_Electricity + IndProd</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> d     TOTS           GDP + Import</span></span></code></pre></div>
<p>With that specification set up, we now run the model using the
<code>new_dict</code> that we constructed earlier.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>specification <span class="op">=</span> <span class="va">specification</span>,</span>
<span>                   dictionary <span class="op">=</span> <span class="va">new_dict</span>,</span>
<span>         </span>
<span>                   present <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   constrain.to.minimum.sample <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualise this model alongisde its forecast:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_fcast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast_model.html">forecast_model</a></span><span class="op">(</span><span class="va">model</span>, plot.forecast <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; No exogenous values provided. Model will forecast the exogenous values with an AR4 process (incl. Q dummies, IIS and SIS w 't.pval = 0.001').</span></span>
<span><span class="co">#&gt; Alternative is exog_fill_method = 'last'.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_fcast</span><span class="op">)</span></span></code></pre></div>
<p><img src="new_variable_to_dict_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
<!-- # Adding a variable from EDGAR -->
<!-- # Creating a new identity -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonas Kurle, Moritz Schwarz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
